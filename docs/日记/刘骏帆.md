# 2022年

## 11月

| 日期  |                             事件                             |
| :---: | :----------------------------------------------------------: |
| 11.23 |    晚上去搭了会车模，把编码器和摄像头从四轮车上换到三轮车    |
| 11.26 | 下午过去把170度的镜头换上镜头坏了用了信标的总钻风模块，晚上过去采集了摄像头在后面的图片 |
| 11.27 | 把摄像头换到前面，采集了摄像头在前面的图像，以及去畸变的标定图 |
| 11.28 | 购买车模所需六角螺丝，调整摄像头位置角度，安装了一下主板和主控，跟师弟一起搞了下编码器，下载第十四届技术报告和查看第十六届技术报告考虑车模结构 |
| 11.29 | 复习数字图像处理，写了几道C语言编程题，分配了一下另外一个团队的大创，比较摆烂 |
| 11.30 |           收拾东西回家，在实验室使用逐飞上位机采图           |

### 11月26日

-   根据十七届的经验，把摄像头放在电机前面，发现这样配合170度广角镜头能够调节到**畸变小，水平角度相对广一点**，缺点：**摄像头角度需要比较平**

### 11月27日

-   起初认为摄像头在电机前面的安装方式，会使得，摄像头的角度需要比较平，最开始认为这样会使得镜头容易反光，感觉没有必要把摄像头放在电机后面

## 12月

| 日期  |                             事件                             |
| :---: | :----------------------------------------------------------: |
| 12.1  |           坐大巴回家，下午到隔离民宿，之后进行摆烂           |
| 12.2  | 更新win11，改用clion配置opencv环境，修改了逆透视的边界涂黑代码 |
| 12.3  |   尝试使用git多分支开发，把opencv仿真图像功能作为开发分支    |
| 12.4  |          学习信息论第五章第一节，晚上摆烂了看了会番          |
| 12.5  |           下午核酸和去邮政，晚上写信息论第五章作业           |
| 12.6  | 早上把opencv工程添加到仓库，中午联系同学借习概书，下午去镇上拿书，晚上写图像处理小组项目作业 |
| 12.7  |                           习概考试                           |
| 12.8  |                   复习工程训练准备明天考试                   |
| 12.9  |           工程训练考试，考完晚上下载ISE，然后摆烂            |
| 12.10 |              发现ISE在WIN11用不了花钱取下vivado              |
| 12.11 | 安装vivado发现没有EDA实验那款芯片，太旧了不支持，破防，复习数字图像处理 |
| 12.30 |              考完期末，晚上准备收拾一下准备干活              |
| 12.31 | 修改扫线判断左右边线的条件，看了一下去畸变发现去畸变后视角小了很多 |

# 2023年

## 1月

|   日期    |                             事件                             |
| :-------: | :----------------------------------------------------------: |
|    1.1    |                          摆烂了一天                          |
|    1.2    | 研究蓝桥杯单片机的板子，想自己画，看了另外一种图像逆透视的思路 |
|    1.3    |         去打疫苗，买了份蓝桥杯PCB，对灰度算法感兴趣          |
|    1.4    |       将扫线换成左右种子扫线，发现自己八零域扫线的BUG        |
|    1.5    | 研究上交大的左右手巡线，尝试灰度算法，尝试成功，但是逆透视之后的图像太模糊经常会被赛道内的灰度不均匀影响 |
|    1.6    | 尝试了不同方法的逆透视，把这条学习上交大左手巡线的代码编写方法（查表）融汇进去我的二值化八零域中，使得代码复用量变小 |
|    1.7    |                         画蓝桥杯板子                         |
|    1.8    | 把边线存储形式从一维数组修改为链表，并且经过测试左右边线存储的较好 |
|    1.9    | 对边线处理增加了三角滤波，初步尝试了半宽补线（还没封装好），在考虑要不要后续把边线数组变成float类型 |
|   1.10    | 学习了上交大的等距边线重采样，局部角度变化率计算，非极大值抑制得到角点角度 |
|   1.11    |                    今天去理发，摆烂了一天                    |
|   1.12    |       去畸变和逆透视加一起变换了，但是发现图像锯齿严重       |
|   1.13    | 听了下南信工的培训会，在考虑要不要原图扫线之后再对边线逆透视会好点 |
|   1.14    |                          摆烂了一天                          |
|   1.15    |                    玩了会新到的蓝桥杯板子                    |
|   1.16    |                      学习C语言条件编译                       |
|   1.17    |                          摆烂了一天                          |
|   1.18    |                          蓝桥杯按键                          |
|   1.19    |                             摆烂                             |
|   1.20    |          给图像处理的头文件加上了防止重复包含头文件          |
| 1.21~1.28 |                           过年摆烂                           |
|   1.29    |             查看了一下队友进度，看了看师弟的问题             |
|   1.30    |                       去泡温泉摆烂一天                       |

## 2月

|   日期    |                             事件                             |
| :-------: | :----------------------------------------------------------: |
|    2.1    |                           摆烂一天                           |
|    2.2    |                         蓝桥杯定时器                         |
|    2.3    |         修改扫线不用边缘涂黑了封装是否对透视图的选择         |
|    2.4    |                             摆烂                             |
|    2.5    |             打表进行逆透视但是去畸变好像没用的？             |
| 2.6~2.10  |                         拔智齿停摆了                         |
|   2.11    |                        蓝桥杯矩阵键盘                        |
|   2.12    |          去畸变，逆透视打表，发现只有逆透视，很奇怪          |
|   2.13    |                      打一天游戏上个王者                      |
| 2.14~2.17 |                         摆烂准备回校                         |
|   2.17    |                          回校搞卫生                          |
|   2.18    |             回去装车，师弟驱动了一下编码器和电机             |
|   2.19    |                          开会铺赛道                          |
|   2.20    |  验证摄像头有没有拆坏，调节了一下摄像头，在车上使用了逆透视  |
|   2.21    |            购买物资，搞课设模块，mpu6050模块成功             |
| 2.22~2.24 |                            搞课设                            |
|   2.25    | 把140度工业镜头换上去，效果不错，移植图像代码，发现ram不足，铺赛道和清洁赛道 |
|   2.26    | 优化掉二值化数组节省22K，加上边界数组又超过ram，扫线正确的不会卡死，调节了一下三轮的机械 |
|   2.27    |          蓝桥杯啊实时时钟芯片和温度芯片，串口重定向          |
|   2.28    |        思考智能车的偏差怎么求好，开始怀疑方案的可行性        |

### 2月25日

-   ram超过了128K，110 x 188的指针变量数组（81K），原图数组和二值化数组120 x 188（20K）确实120多K了

### 2月26日

-   105K也超出内存，不知道为什么，芯片手册说ram是120K，无奈只能压缩图像透视之后的变成96 x 60一个像素2cm，改完之后内存占用为71K

### 2月27日

-   三轮的后轮轴承是可以拆的，把轮子和齿轮拆下来之后，就可以从中间地方把那条杆抽出来

## 3月

|   日期    |                             事件                             |
| :-------: | :----------------------------------------------------------: |
|    3.1    | 重新看了遍南信工讲解上交大代码，把上交大求偏差移植过来，挺好用的但是不知道如何根据元素去判断预瞄点，测试了图像的运行时间，一帧普通赛道处理6ms二值化使用了5ms |
|    3.2    |               师弟跑车编码器45无元素单边寻右线               |
|    3.3    |              我去提速提速到120无元素单边寻右线               |
|    3.4    |                 开会意识到应该加入左右线切换                 |
|    3.5    | 扫线改为扫到丢线就结束，左右线切换测试跑起来失败不知道什么原因，电机出问题不是编码器读不到是因为中断出问题了好像 |
|    3.6    | 逆透视的禁止区域改成255为了LCD显示，封装一下函数到process加入一些LCD的编写一些画图函数，晚上去调车到10点半，140左右线切换，但是路径不好，速度环有问题 |
|    3.7    |                        课设，复习六级                        |
|  3.8~3.9  |                             课设                             |
|   3.10    |  教师弟写十字，去实验室采集了赛道图像，指导师弟排查十字BUG   |
|   3.11    |                  备考6级，组织讨论校赛规则                   |
|   3.12    |                            考6级                             |
| 3.13~3.17 |                             课设                             |
|   3.18    |            给团队讲图像处理方案，之前写了环岛入环            |
|   3.19    |               蓝桥杯单片机外部中断，写环岛出环               |
|   3.20    |                         环岛一跑成功                         |
|   3.21    |                           摆烂一天                           |
| 3.22~3.23 |                         课设通讯模块                         |
|   3.24    |               调摄像头角度，修改二值化，换轮胎               |
|   3.25    |              蓝桥杯第十三届题目，中断刷新数码管              |
|   3.26    |                  蓝桥杯按键写好S12修改菜单                   |
|   3.27    | 调控制希望解决转弯轮子抖动问题，没看出个所以然，速度环响应400ms有点慢但是上不去了，左右线切换要考虑到右边开始就有一点丢线，但是左边有10多条线的情况，需要继续改进 |
|   3.28    |                         课设多机通讯                         |
|   3.29    |     调课设飞控，考虑差速方式，内轮减速外轮不变，外加内减     |
|   3.30    |                             课设                             |
|   3.31    |           调整环岛出环和环岛结束的识别以及偏差处理           |
|           |                                                              |
|           |                                                              |
|           |                                                              |
|           |                                                              |
|           |                                                              |

### 3月6日

-   电机一开疯转的原因还在，编码器问题，不是中断问题，因为只有左轮这样右轮不会，编码器没坏，考虑是板子接触不良的问题，因为蓝牙也会插上去之后电源灯都不亮，需要再次插拔才正常，**希望换一块主控之后问题得到解决**

### 3月18日

-   加上电磁杆之后，车跑不了，一直乱跑而且还右转，拆掉之后好了，考虑是图像的问题，然后把电磁杆贴在车上再跑又可以，然后突然就电机老样子不稳定的疯转，而且有时候还会在中途猛的加速。目前对应方案，考虑编码器坏了换个编码器试试

### 3月19日

-   在写环岛出环的时候发现了自己的中线很垃圾，好像是因为求偏差的时候进行中线归一化，前车轮的点是在中间下面，所以会出现这种抽象的中线，但是这好像是合理的，因为车确实是这么行进的。
-   如果把车前轮的列坐标改成第一行的中间点也是可以让中线变得很好看，但是好像，求的偏差确实是应该用图像的中间去求偏差

![image-20230319200824929](C:/Users/30516/AppData/Roaming/Typora/typora-user-images/image-20230319200824929.png)

![image-20230319204836732](C:/Users/30516/AppData/Roaming/Typora/typora-user-images/image-20230319204836732.png)

-   也正因为有这个归一化的点，我们的中线才能有这样的效果

![image-20230319222632401](C:/Users/30516/AppData/Roaming/Typora/typora-user-images/image-20230319222632401.png)

### 3月31日

-   环岛出环结束的判断，之前是使用，右边线从不丢线->丢线->不丢线，即环岛结束，修改为电磁中间电感差异很大->找到右边线不丢线，表示出环结束
-   判断环岛是否结束的时候，之前是无脑寻右边线，等到，左右边线相差不大即结束，为了避免**出环结束之后，左右边线就丢线导致提前出环结束，和继承上一次的偏差使得车子再次进环**,修改为，判断右边线是否没丢线，如果右边线一开始就小于循迹的前瞻，那么则说明没有出环结束，进入特殊扫线，寻右边线，如果特殊扫线也没成功，那么则手动设定偏差，往右边走一点点，并且，修改循迹状态为**trackspecial**，否则会继承上一次偏差

## 4月
|      日期       |                             事件                             |
| :-------------: | :----------------------------------------------------------: |
|     4月1日      |                 小车发癫，一直在找问题没找到                 |
|  4月2日~4月3日  |                           课设报告                           |
|     4月4日      |                   小车发癫是因为编码器坏了                   |
|  4月5日~4月8日  |                          冲刺蓝桥杯                          |
|     4月9日      |                 调环岛，识别没问题路径大问题                 |
| 4月10日~4月13日 |                    修改灰度扫线和边线透视                    |
|     4月14日     |   修改边线透视的数组长度让插值后的透视边线长度变量单独开来   |
|     4月15日     |                         重写环岛入环                         |
|     4月16日     |                         重写环岛出环                         |
|      4.17       | 解决了灰度扫线在均色范围出错的问题，环岛也能跑但是还差电磁判断出环结束 |
|      4.21       | 播种改成了sobel播种，但是入环还是进不去，也不知道为什么有时候会卡死 |
|      4.22       | 播种改会中间往两边的差比和，稳定很多，卡死是因为模糊PID越界  |
|      4.23       |                        等陀螺仪停一天                        |
|      4.24       | 下午调环岛，分段速度进环，环岛住呢比入环修改为编码器，出环有问题，晚上装车发现控制不太行 |
|      4.25       | 环岛换成陀螺仪出环稳了很多，但是控制不行环内姿态不好的话会不行 |
|    4.26~4.28    | 左轮车轴老是松动，换了个法兰和吉米螺丝好很多，但是还是会，可能要更换车轴，环岛有个远古BUG，环岛结束函数插值的位置放错了 |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |
|                 |                                                              |


### 4月1日

![image-20230401201822678](C:/Users/30516/AppData/Roaming/Typora/typora-user-images/image-20230401201822678.png)

-   由于避免斑马线干扰的播种保护措施，会把种子播种在孤立的白点中，这时候八零域的扫线会一直循环打转，以至于，左边线的长度是有的，但是边线的数据不对，计算出来的偏差是往左边的很大的数据。

### 4月22日

**环岛进不去的原因猜测：**

-   [ ] 每次都是头转过去了但是却直接从环内冲出去了，可能是因为太偏外了，以至于播种失败，这里可以尝试去修改中间往两边，起始点的位置，不一定是在中间开始

-   [ ] 太早进入入环状态了,虽然有继承上一次的偏差，但是上一次的偏差可能是很小的
-   [ ] 环岛入环状态的误判
